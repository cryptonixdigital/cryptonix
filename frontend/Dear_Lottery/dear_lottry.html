<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dear Lottery - With Edit/Delete Function</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 15px;
        }
        
        .container {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 900px;
            padding: 20px;
            text-align: center;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        .header {
            margin-bottom: 20px;
        }
        
        h1 {
            color: #b21f1f;
            margin-bottom: 12px;
            font-size: 24px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .description {
            color: #444;
            margin-bottom: 8px;
            line-height: 1.5;
            font-size: 14px;
        }
        
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
            padding-bottom: 8px;
            flex-wrap: wrap;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }
        
        .tab {
            padding: 10px 15px;
            background: #e0e0e0;
            border: none;
            border-radius: 6px 6px 0 0;
            margin: 0 3px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            min-width: 100px;
            color: #333;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .tab.active {
            background: linear-gradient(to right, #1a2a6c, #b21f1f);
            color: white;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }
        
        .tab:hover {
            background: #d0d0d0;
            transform: translateY(-2px);
        }
        
        .tab-content {
            display: none;
            padding: 15px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .game-type-selector {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .game-type-btn {
            padding: 12px 20px;
            background: #e0e0e0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            color: #333;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .game-type-btn.active {
            background: linear-gradient(to right, #1a2a6c, #b21f1f);
            color: white;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        }
        
        .input-group {
            margin-bottom: 15px;
            text-align: left;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            border-color: #6a11cb;
            outline: none;
        }
        
        button {
            background: linear-gradient(to right, #1a2a6c, #b21f1f);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            margin: 8px 3px;
            width: 100%;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .btn-success {
            background: linear-gradient(to right, #1a2a6c, #00b09b);
        }
        
        .btn-danger {
            background: linear-gradient(to right, #dc2430, #7b4397);
        }
        
        .btn-warning {
            background: linear-gradient(to right, #ff9966, #ff5e62);
        }
        
        .result {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.08);
        }
        
        .result h3 {
            color: #1a2a6c;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .lottery-number {
            font-size: 24px;
            font-weight: 800;
            color: #1a2a6c;
            letter-spacing: 3px;
            background: linear-gradient(135deg, #fdbb2d, #b21f1f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            padding: 12px;
            border: 2px dashed #b21f1f;
            border-radius: 8px;
            margin: 15px 0;
            word-break: break-all;
        }
        
        .game-results {
            display: flex;
            flex-direction: column;
            margin: 15px 0;
        }
        
        .game-result {
            margin: 8px 0;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
            position: relative;
        }
        
        .game-result h3 {
            color: #1a2a6c;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .action-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .edit-btn {
            background: #fdbb2d;
            color: #1a2a6c;
        }
        
        .delete-btn {
            background: #dc3545;
            color: white;
        }
        
        .save-counter {
            background: #fdbb2d;
            color: #1a2a6c;
            padding: 8px 12px;
            border-radius: 15px;
            font-weight: bold;
            margin-top: 12px;
            display: inline-block;
            font-size: 14px;
        }
        
        .footer {
            margin-top: 20px;
            color: #666;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .confirmation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            gap: 10px;
        }
        
        @media (min-width: 768px) {
            .container {
                padding: 30px;
            }
            
            h1 {
                font-size: 32px;
                margin-bottom: 15px;
            }
            
            .description {
                font-size: 18px;
                margin-bottom: 10px;
            }
            
            .tab {
                padding: 12px 25px;
                font-size: 16px;
                margin: 0 5px;
                min-width: auto;
            }
            
            .game-results {
                flex-direction: row;
                justify-content: space-between;
                flex-wrap: wrap;
            }
            
            .game-result {
                flex: 1;
                min-width: 220px;
                margin: 10px;
            }
            
            .lottery-number {
                font-size: 32px;
                letter-spacing: 4px;
            }
        }
        
        @media (max-width: 360px) {
            .tab {
                padding: 8px 12px;
                font-size: 12px;
                min-width: 80px;
            }
            
            .game-type-btn {
                padding: 10px 15px;
                font-size: 14px;
            }
            
            .lottery-number {
                font-size: 20px;
                letter-spacing: 2px;
            }
            
            button {
                padding: 12px 15px;
                font-size: 14px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }

        .login-message {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .login-message button {
            max-width: 200px;
            margin: 15px auto;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #1a2a6c;
        }
    </style>
    
    <!-- Firebase App (Core) -->
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
    <!-- Firebase Auth -->
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth-compat.js"></script>
    <!-- Firebase Database -->
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-database-compat.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>6 Games Daily - 1CR (3 Games) And 5CR (3 Games)</h1>
            
        </div>

        <!-- Show when user is not logged in -->
        <div id="loginRequired" class="login-message">
            <h2>Login Required</h2>
            <p>You need to login to access this page</p>
            <button onclick="window.location.href='../login.html'">Go to Login Page</button>
        </div>
        
        <!-- Show when user is logged in -->
        <div id="appContent" style="display: none;">
            <div class="tabs">
                <button class="tab active" data-tab="entry">Results</button>
                <button class="tab" data-tab="prediction">Lucky Numbers</button>
                <button class="tab" data-tab="history">History</button>
                <button class="tab" data-tab="manage">Data Management</button>
            </div>
            
            <div class="tab-content active" id="entry">
                <h2>Result Entry</h2>
                
                <div class="game-type-selector">
                    <button class="game-type-btn active" data-game-type="1cr">1CR Game</button>
                    <button class="game-type-btn" data-game-type="5cr">5CR Game</button>
                </div>
                
                <div class="input-group">
                    <label for="resultDate">Date</label>
                    <input type="date" id="resultDate">
                </div>
                
                <div class="input-group">
                    <label for="drawTime">Select Time</label>
                    <select id="drawTime">
                        <option value="afternoon">1:00 PM</option>
                        <option value="evening">6:00 PM</option>
                        <option value="night">8:00 PM</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="lotteryNumber">Winning Number</label>
                    <input type="text" id="lotteryNumber" placeholder="65G93018">
                </div>
                
                <button class="btn-success" id="saveResult">Save</button>
                
                <div class="save-counter">Total Saved: <span id="saveCount">0</span></div>
                
                <div class="result">
                    <h3 id="selectedDateResult">Today's Results</h3>
                    
                    <div class="game-results">
                        <div class="game-result">
                            <h3>1CR - 1:00 PM</h3>
                            <div class="lottery-number" id="1crAfternoonResult">---</div>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" data-game-type="1cr" data-time="afternoon">Edit</button>
                                <button class="action-btn delete-btn" data-game-type="1cr" data-time="afternoon">Delete</button>
                            </div>
                        </div>
                        <div class="game-result">
                            <h3>1CR - 6:00 PM</h3>
                            <div class="lottery-number" id="1crEveningResult">---</div>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" data-game-type="1cr" data-time="evening">Edit</button>
                                <button class="action-btn delete-btn" data-game-type="1cr" data-time="evening">Delete</button>
                            </div>
                        </div>
                        <div class="game-result">
                            <h3>1CR - 8:00 PM</h3>
                            <div class="lottery-number" id="1crNightResult">---</div>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" data-game-type="1cr" data-time="night">Edit</button>
                                <button class="action-btn delete-btn" data-game-type="1cr" data-time="night">Delete</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="game-results">
                        <div class="game-result">
                            <h3>5CR - 1:00 PM</h3>
                            <div class="lottery-number" id="5crAfternoonResult">---</div>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" data-game-type="5cr" data-time="afternoon">Edit</button>
                                <button class="action-btn delete-btn" data-game-type="5cr" data-time="afternoon">Delete</button>
                            </div>
                        </div>
                        <div class="game-result">
                            <h3>5CR - 6:00 PM</h3>
                            <div class="lottery-number" id="5crEveningResult">---</div>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" data-game-type="5cr" data-time="evening">Edit</button>
                                <button class="action-btn delete-btn" data-game-type="5cr" data-time="evening">Delete</button>
                            </div>
                        </div>
                        <div class="game-result">
                            <h3>5CR - 8:00 PM</h3>
                            <div class="lottery-number" id="5crNightResult">---</div>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" data-game-type="5cr" data-time="night">Edit</button>
                                <button class="action-btn delete-btn" data-game-type="5cr" data-time="night">Delete</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="prediction">
                <h2>Lucky Numbers</h2>
                
                <div class="game-type-selector">
                    <button class="game-type-btn active" data-game-type="1cr">1CR Game</button>
                    <button class="game-type-btn" data-game-type="5cr">5CR Game</button>
                </div>
                
                <button id="generateLucky">Generate Lucky Numbers</button>
                
                <div class="result">
                    <h3 id="luckyNumberTitle">1CR Game Lucky Numbers</h3>
                    <div class="lottery-number" id="luckyNumber">---</div>
                    
                    <div class="game-results">
                        <div class="game-result">
                            <h3>For 1:00 PM</h3>
                            <div class="lottery-number" id="luckyAfternoon">---</div>
                        </div>
                        <div class="game-result">
                            <h3>For 6:00 PM</h3>
                            <div class="lottery-number" id="luckyEvening">---</div>
                        </div>
                        <div class="game-result">
                            <h3>For 8:00 PM</h3>
                            <div class="lottery-number" id="luckyNight">---</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="history">
                <h2>Result History</h2>
                
                <div class="game-type-selector">
                    <button class="game-type-btn active" data-game-type="1cr">1CR Game</button>
                    <button class="game-type-btn" data-game-type="5cr">5CR Game</button>
                </div>
                
                <div class="input-group">
                    <label for="historyDate">Select Date</label>
                    <input type="date" id="historyDate">
                </div>
                
                <button id="loadHistory">View History</button>
                
                <div class="result">
                    <h3 id="historyDateTitle">1CR Game History</h3>
                    <div id="historyResults"></div>
                </div>
            </div>
            
            <div class="tab-content" id="manage">
                <h2>Data Management</h2>
                
                <div class="result">
                    <h3>Manage All Data</h3>
                    
                    <div class="input-group">
                        <label for="manageDate">Select Date</label>
                        <input type="date" id="manageDate">
                    </div>
                    
                    <button id="loadManageData">Load Data</button>
                    
                    <div id="manageResults" style="margin-top: 20px;"></div>
                    
                    <div style="margin-top: 30px;">
                        <h3>Data Reset</h3>
                        <p style="color: #b21f1f; margin: 15px 0;">Warning: This operation is irreversible. All data will be deleted.</p>
                        <button class="btn-danger" id="resetAllData">Reset All Data</button>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                <footer style="text-align: center; font-size: 12px; color: #444; padding: 15px; border-top: 1px solid #ccc; background: #f8f8f8;">
  <p>
    <strong>⚠️ Disclaimer:</strong><br>
    Lottery Guru is created for entertainment purposes only. The lottery numbers or lucky number suggestions 
    are generated based on daily results and certain calculations combined with randomization. 
    These numbers should not be considered guaranteed winning predictions. 
    Any decision to purchase lottery tickets or invest is entirely at your own risk. 
    The app owner or developer is not responsible for any financial loss, damage, or unexpected outcomes.
  </p>
  <p style="margin-top: 10px;">
    🔗 Visit: <a href="https://cryptonixdigital.github.io/cryptonix/frontend/dear_lottry_main.html" target="_blank" style="color: #007BFF; text-decoration: none;">Lottery Guru</a>
  </p>
</footer>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="confirmation-modal" id="confirmationModal">
        <div class="modal-content">
            <h3 id="modalTitle">Are you sure?</h3>
            <p id="modalMessage">This action cannot be undone.</p>
            <div class="modal-buttons">
                <button class="btn-danger" id="modalConfirm">Yes</button>
                <button id="modalCancel">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCi5n-L_ogUif2Bsq7l8qfU9Yoq9h7J6VE",
            authDomain: "cryptonix-67333.firebaseapp.com",
            databaseURL: "https://cryptonix-67333-default-rtdb.firebaseio.com",
            projectId: "cryptonix-67333",
            storageBucket: "cryptonix-67333.firebasestorage.app",
            messagingSenderId: "701360318410",
            appId: "1:701360318410:web:050c6ced8857cc0d2b5133",
            measurementId: "G-Y131E5B1QF"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        // Global variables
        let currentUser = null;
        let selectedGameType = '1cr';
        let currentAction = { type: '', gameType: '', time: '', callback: null };

        // Check authentication state
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                document.getElementById('loginRequired').style.display = 'none';
                document.getElementById('appContent').style.display = 'block';
                console.log("User logged in:", user.uid);
                loadAllData();
            } else {
                document.getElementById('loginRequired').style.display = 'block';
                document.getElementById('appContent').style.display = 'none';
                console.log("User not logged in");
            }
        });

        // Function to get user-specific database reference
        function getUserRef(path = '') {
            if (!currentUser) {
                console.error("No current user");
                return null;
            }
            return db.ref(`users/${currentUser.uid}/${path}`);
        }

        // Function to get lottery results reference
        function getResultsRef() {
            return getUserRef('lotteryResults');
        }

        // Function to get save count reference
        function getSaveCountRef() {
            return getUserRef('saveCount');
        }

        // Time name function
        function getTimeName(time) {
            const timeNames = {
                'afternoon': '1:00 PM',
                'evening': '6:00 PM', 
                'night': '8:00 PM'
            };
            return timeNames[time] || time;
        }

        // Number validation function
        function isValidNumber(number) {
            // 8 character number, first two digits, then one English letter, then five digits
            const regex = /^[0-9]{2}[A-Z]{1}[0-9]{5}$/;
            return regex.test(number);
        }

        // Confirmation modal functions
        function showConfirmationModal(title, message, callback) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            document.getElementById('confirmationModal').style.display = 'flex';
            
            currentAction.callback = callback;
        }
        
        function hideConfirmationModal() {
            document.getElementById('confirmationModal').style.display = 'none';
            currentAction.callback = null;
        }

        // Game type UI update function
        function updateGameTypeUI() {
            // Lucky number title update
            const gameTypeText = selectedGameType === '1cr' ? '1CR' : '5CR';
            document.getElementById('luckyNumberTitle').textContent = `${gameTypeText} Game Lucky Numbers`;
            
            // History title update
            document.getElementById('historyDateTitle').textContent = `${gameTypeText} Game History`;
            
            // Reload date results
            loadDateResults(document.getElementById('resultDate').value);
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date
            const today = new Date();
            document.getElementById('resultDate').valueAsDate = today;
            document.getElementById('historyDate').valueAsDate = today;
            document.getElementById('manageDate').valueAsDate = today;
            
            // Save result event
            document.getElementById('saveResult').addEventListener('click', function() {
                const date = document.getElementById('resultDate').value;
                const time = document.getElementById('drawTime').value;
                const number = document.getElementById('lotteryNumber').value.trim().toUpperCase();
                
                saveResult(date, time, number);
            });
            
            // Generate lucky numbers
            document.getElementById('generateLucky').addEventListener('click', function() {
                analyzeAndGenerateLuckyNumber();
            });
            
            // Load history
            document.getElementById('loadHistory').addEventListener('click', function() {
                loadHistory();
            });
            
            // Load manage data
            document.getElementById('loadManageData').addEventListener('click', function() {
                loadManageData();
            });
            
            // Reset all data
            document.getElementById('resetAllData').addEventListener('click', function() {
                showConfirmationModal(
                    'Reset All Data', 
                    'Are you sure you want to delete all data? This action cannot be undone.',
                    resetAllData
                );
            });
            
            // Load results when date changes
            document.getElementById('resultDate').addEventListener('change', function() {
                loadDateResults(this.value);
            });
            
            // Edit button events
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const gameType = this.getAttribute('data-game-type');
                    const time = this.getAttribute('data-time');
                    editResult(gameType, time);
                });
            });
            
            // Delete button events
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const gameType = this.getAttribute('data-game-type');
                    const time = this.getAttribute('data-time');
                    
                    showConfirmationModal(
                        'Delete Result', 
                        `Are you sure you want to delete ${getTimeName(time)} ${gameType.toUpperCase()} result?`,
                        function() { deleteResult(gameType, time); }
                    );
                });
            });
            
            // Modal events
            document.getElementById('modalConfirm').addEventListener('click', function() {
                if (currentAction.callback) {
                    currentAction.callback();
                }
                hideConfirmationModal();
            });
            
            document.getElementById('modalCancel').addEventListener('click', function() {
                hideConfirmationModal();
            });

            // Tab functionality
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and contents
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(tc => tc.classList.remove('active'));
                    
                    // Add active class to selected tab and content
                    tab.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                    
                    // Scroll to top on mobile devices when clicking tabs
                    if (window.innerWidth < 768) {
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                });
            });
            
            // Game type selector
            const gameTypeBtns = document.querySelectorAll('.game-type-btn');
            gameTypeBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    gameTypeBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    selectedGameType = btn.getAttribute('data-game-type');
                    
                    // Update UI
                    updateGameTypeUI();
                });
            });
        });
        
        // Functions
        function loadAllData() {
            // Load save count
            const saveCountRef = getSaveCountRef();
            if (!saveCountRef) return;
            
            saveCountRef.once('value').then((snapshot) => {
                const saveCount = snapshot.val() || 0;
                document.getElementById('saveCount').textContent = saveCount;
                console.log("Save count loaded:", saveCount);
            }).catch((error) => {
                console.error("Error loading save count:", error);
            });
            
            // Load today's results
            loadDateResults(new Date().toISOString().slice(0, 10));
        }
        
        function loadDateResults(dateString) {
            const date = new Date(dateString);
            const dateKey = date.toDateString();
            const resultsRef = getResultsRef();
            if (!resultsRef) return;
            
            resultsRef.once('value').then((snapshot) => {
                const results = snapshot.val() || {};
                console.log("Loaded results for", dateKey, ":", results);
                
                // Update date title
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                const dateTitle = date.toLocaleDateString('en-US', options);
                document.getElementById('selectedDateResult').textContent = `Results for ${dateTitle}`;
                
                // 1CR game results
                document.getElementById('1crAfternoonResult').textContent = (results[dateKey] && results[dateKey]['1cr_afternoon']) || '---';
                document.getElementById('1crEveningResult').textContent = (results[dateKey] && results[dateKey]['1cr_evening']) || '---';
                document.getElementById('1crNightResult').textContent = (results[dateKey] && results[dateKey]['1cr_night']) || '---';
                
                // 5CR game results
                document.getElementById('5crAfternoonResult').textContent = (results[dateKey] && results[dateKey]['5cr_afternoon']) || '---';
                document.getElementById('5crEveningResult').textContent = (results[dateKey] && results[dateKey]['5cr_evening']) || '---';
                document.getElementById('5crNightResult').textContent = (results[dateKey] && results[dateKey]['5cr_night']) || '---';
            }).catch((error) => {
                console.error("Error loading date results:", error);
            });
        }
        
        function saveResult(dateString, time, number) {
            if (!number) {
                alert('Please enter a valid number');
                return;
            }
            
            if (!isValidNumber(number)) {
                alert('Please enter a number in the correct format (e.g., 65G93018) - first two digits, then one English letter, then five digits');
                return;
            }
            
            const date = new Date(dateString);
            const dateKey = date.toDateString();
            const resultsRef = getResultsRef();
            const saveCountRef = getSaveCountRef();
            if (!resultsRef || !saveCountRef) return;
            
            resultsRef.once('value').then((snapshot) => {
                let results = snapshot.val() || {};
                
                if (!results[dateKey]) {
                    results[dateKey] = {};
                }
                
                // Create game key (e.g., 1cr_afternoon)
                const gameKey = `${selectedGameType}_${time}`;
                results[dateKey][gameKey] = number;
                
                // Save data to Firebase
                resultsRef.set(results).then(() => {
                    console.log("Result saved successfully:", results);
                    
                    // Increase save count
                    saveCountRef.once('value').then((countSnapshot) => {
                        const saveCount = (countSnapshot.val() || 0) + 1;
                        saveCountRef.set(saveCount).then(() => {
                            document.getElementById('saveCount').textContent = saveCount;
                            
                            // Update UI
                            loadDateResults(dateString);
                            
                            // Clear input field
                            document.getElementById('lotteryNumber').value = '';
                            
                            alert(`${selectedGameType.toUpperCase()} - ${getTimeName(time)} result saved successfully!`);
                        });
                    });
                }).catch((error) => {
                    console.error("Error saving result:", error);
                    alert('Error saving result. Please try again.');
                });
            });
        }
        
        function editResult(gameType, time) {
            const date = document.getElementById('resultDate').value;
            const dateKey = new Date(date).toDateString();
            const resultsRef = getResultsRef();
            if (!resultsRef) return;
            
            resultsRef.once('value').then((snapshot) => {
                const results = snapshot.val() || {};
                
                if (results[dateKey] && results[dateKey][`${gameType}_${time}`]) {
                    // Select game type
                    document.querySelectorAll('.game-type-btn').forEach(btn => {
                        if (btn.getAttribute('data-game-type') === gameType) {
                            btn.click();
                        }
                    });
                    
                    // Select time
                    document.getElementById('drawTime').value = time;
                    
                    // Set number
                    document.getElementById('lotteryNumber').value = results[dateKey][`${gameType}_${time}`];
                    
                    alert(`${gameType.toUpperCase()} - ${getTimeName(time)} result ready for editing. Click Save to update.`);
                } else {
                    alert('No result found for this time.');
                }
            });
        }
        
        function deleteResult(gameType, time) {
            const date = document.getElementById('resultDate').value;
            const dateKey = new Date(date).toDateString();
            const resultsRef = getResultsRef();
            const saveCountRef = getSaveCountRef();
            if (!resultsRef || !saveCountRef) return;
            
            resultsRef.once('value').then((snapshot) => {
                let results = snapshot.val() || {};
                
                if (results[dateKey] && results[dateKey][`${gameType}_${time}`]) {
                    delete results[dateKey][`${gameType}_${time}`];
                    
                    // If no data left for the date, delete the entire date
                    if (Object.keys(results[dateKey]).length === 0) {
                        delete results[dateKey];
                    }
                    
                    // Save updated data to Firebase
                    resultsRef.set(results).then(() => {
                        // Decrease save count
                        saveCountRef.once('value').then((countSnapshot) => {
                            const saveCount = Math.max(0, (countSnapshot.val() || 0) - 1);
                            saveCountRef.set(saveCount).then(() => {
                                document.getElementById('saveCount').textContent = saveCount;
                                
                                // Update UI
                                loadDateResults(date);
                                
                                alert(`${gameType.toUpperCase()} - ${getTimeName(time)} result deleted successfully!`);
                            });
                        });
                    }).catch((error) => {
                        console.error("Error deleting result:", error);
                        alert('Error deleting result. Please try again.');
                    });
                }
            });
        }
        
        // Analyze all data and generate lucky number (hot number)
        function analyzeAndGenerateLuckyNumber() {
            const resultsRef = getResultsRef();
            if (!resultsRef) return;
            
            resultsRef.once('value').then((snapshot) => {
                const results = snapshot.val() || {};
                const allNumbers = [];
                
                // Collect all saved numbers
                for (const date in results) {
                    for (const key in results[date]) {
                        if (results[date][key] && results[date][key] !== '---') {
                            allNumbers.push(results[date][key]);
                        }
                    }
                }
                
                if (allNumbers.length === 0) {
                    alert('No data found. Please save some results first.');
                    return;
                }
                
                // Frequency analysis
                const digitFrequency = {0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0};
                const letterFrequency = {A:0,B:0,C:0,D:0,E:0,G:0,H:0,J:0,K:0,L:0};
                
                allNumbers.forEach(number => {
                    // Analyze number part (positions 0,1,3,4,5,6,7)
                    for (let i = 0; i < 8; i++) {
                        if (i !== 2) { // 3rd position is letter, skip
                            const char = number[i];
                            if (!isNaN(char)) {
                                digitFrequency[char]++;
                            }
                        }
                    }
                    
                    // Analyze letter part (position 2)
                    const letter = number[2];
                    if (letterFrequency.hasOwnProperty(letter)) {
                        letterFrequency[letter]++;
                    }
                });
                
                // Find most used digits and letters (hot numbers)
                const mostUsedDigits = findMostUsed(digitFrequency, 2);
                const mostUsedLetter = findMostUsed(letterFrequency, 1)[0];
                
                // Create lucky number (hot number)
                const baseNumber = mostUsedDigits[0] + mostUsedDigits[1] + mostUsedLetter + 
                                  getRandomDigits(5, digitFrequency, true);
                
                document.getElementById('luckyNumber').textContent = baseNumber;
                
                // Generate different numbers for each time
                document.getElementById('luckyAfternoon').textContent = generateTimeSpecificNumber(baseNumber, 'afternoon');
                document.getElementById('luckyEvening').textContent = generateTimeSpecificNumber(baseNumber, 'evening');
                document.getElementById('luckyNight').textContent = generateTimeSpecificNumber(baseNumber, 'night');
                
                // Show analysis report
                showAnalysisReport(digitFrequency, letterFrequency, baseNumber);
            }).catch((error) => {
                console.error("Error generating lucky number:", error);
                alert('Error generating lucky numbers. Please try again.');
            });
        }
        
        function findMostUsed(frequencyObj, count) {
            return Object.entries(frequencyObj)
                .sort((a, b) => b[1] - a[1])
                .slice(0, count)
                .map(item => item[0]);
        }
        
        function getRandomDigits(length, frequency, useMostFrequent) {
            let result = '';
            const sortedDigits = Object.entries(frequency)
                .sort((a, b) => useMostFrequent ? b[1] - a[1] : a[1] - b[1])
                .slice(0, 10);
            
            for (let i = 0; i < length; i++) {
                // Randomly select from most used numbers
                const randomIndex = Math.floor(Math.random() * Math.min(5, sortedDigits.length));
                result += sortedDigits[randomIndex][0];
            }
            return result;
        }
        
        function generateTimeSpecificNumber(baseNumber, time) {
            // Allowed English letters
            const allowedLetters = ['A', 'B', 'C', 'D', 'E', 'G', 'H', 'J', 'K', 'L'];
            
            // Change number based on time
            const timeFactors = {
                'afternoon': 3,
                'evening': 7,
                'night': 11
            };
            
            const factor = timeFactors[time];
            
            // Change first two digits
            let firstTwo = parseInt(baseNumber.substring(0, 2));
            firstTwo = (firstTwo + factor) % 100;
            const newFirstTwo = firstTwo.toString().padStart(2, '0');
            
            // Change middle letter (only use allowed letters)
            const originalChar = baseNumber.substring(2, 3);
            const currentIndex = allowedLetters.indexOf(originalChar);
            const newIndex = (currentIndex + factor) % allowedLetters.length;
            const newChar = allowedLetters[newIndex];
            
            // Change last five digits
            let lastFive = parseInt(baseNumber.substring(3));
            lastFive = (lastFive + factor) % 100000;
            const newLastFive = lastFive.toString().padStart(5, '0');
            
            return newFirstTwo + newChar + newLastFive;
        }
        
        function showAnalysisReport(digitFrequency, letterFrequency, luckyNumber) {
            console.log('Digit frequency:', digitFrequency);
            console.log('Letter frequency:', letterFrequency);
            console.log('Generated lucky number:', luckyNumber);
        }
        
        // Load history function
        function loadHistory() {
            const date = document.getElementById('historyDate').value;
            const dateKey = new Date(date).toDateString();
            const resultsRef = getResultsRef();
            if (!resultsRef) return;
            
            resultsRef.once('value').then((snapshot) => {
                const results = snapshot.val() || {};
                const historyResults = document.getElementById('historyResults');
                
                if (results[dateKey]) {
                    let html = '<div class="game-results">';
                    
                    // Show selected game type results
                    ['afternoon', 'evening', 'night'].forEach(time => {
                        const resultKey = `${selectedGameType}_${time}`;
                        const result = results[dateKey][resultKey] || '---';
                        html += `
                            <div class="game-result">
                                <h3>${getTimeName(time)}</h3>
                                <div class="lottery-number">${result}</div>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    historyResults.innerHTML = html;
                } else {
                    historyResults.innerHTML = '<p>No results found for this date.</p>';
                }
            }).catch((error) => {
                console.error("Error loading history:", error);
                alert('Error loading history. Please try again.');
            });
        }
        
        function loadManageData() {
            const date = document.getElementById('manageDate').value;
            const dateKey = new Date(date).toDateString();
            const resultsRef = getResultsRef();
            if (!resultsRef) return;
            
            resultsRef.once('value').then((snapshot) => {
                const results = snapshot.val() || {};
                const manageResults = document.getElementById('manageResults');
                
                if (results[dateKey]) {
                    let html = '<h3>Results:</h3><div class="game-results">';
                    
                    // 1CR game results
                    html += '<div style="width: 100%; margin-bottom: 20px;"><h4>1CR Game</h4>';
                    ['afternoon', 'evening', 'night'].forEach(time => {
                        const result = results[dateKey][`1cr_${time}`] || '---';
                        html += `
                            <div class="game-result">
                                <h3>${getTimeName(time)}</h3>
                                <div class="lottery-number">${result}</div>
                                <div class="action-buttons">
                                    <button class="action-btn edit-btn" onclick="manageEditResult('1cr', '${time}', '${date}')">Edit</button>
                                    <button class="action-btn delete-btn" onclick="manageDeleteResult('1cr', '${time}', '${date}')">Delete</button>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                    
                    // 5CR game results
                    html += '<div style="width: 100%;"><h4>5CR Game</h4>';
                    ['afternoon', 'evening', 'night'].forEach(time => {
                        const result = results[dateKey][`5cr_${time}`] || '---';
                        html += `
                            <div class="game-result">
                                <h3>${getTimeName(time)}</h3>
                                <div class="lottery-number">${result}</div>
                                <div class="action-buttons">
                                    <button class="action-btn edit-btn" onclick="manageEditResult('5cr', '${time}', '${date}')">Edit</button>
                                    <button class="action-btn delete-btn" onclick="manageDeleteResult('5cr', '${time}', '${date}')">Delete</button>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div></div>';
                    
                    manageResults.innerHTML = html;
                } else {
                    manageResults.innerHTML = '<p>No results found for this date.</p>';
                }
            }).catch((error) => {
                console.error("Error loading manage data:", error);
                alert('Error loading data. Please try again.');
            });
        }
        
        // Global functions for management
        window.manageEditResult = function(gameType, time, date) {
            document.getElementById('resultDate').value = date;
            document.querySelector(`.tab[data-tab="entry"]`).click();
            
            setTimeout(() => {
                document.querySelectorAll('.game-type-btn').forEach(btn => {
                    if (btn.getAttribute('data-game-type') === gameType) {
                        btn.click();
                    }
                });
                
                document.getElementById('drawTime').value = time;
                
                const dateKey = new Date(date).toDateString();
                const resultsRef = getResultsRef();
                if (!resultsRef) return;
                
                resultsRef.once('value').then((snapshot) => {
                    const results = snapshot.val() || {};
                    if (results[dateKey] && results[dateKey][`${gameType}_${time}`]) {
                        document.getElementById('lotteryNumber').value = results[dateKey][`${gameType}_${time}`];
                    }
                });
            }, 100);
        };
        
        window.manageDeleteResult = function(gameType, time, date) {
            showConfirmationModal(
                'Delete Result', 
                `Are you sure you want to delete ${date} ${getTimeName(time)} ${gameType.toUpperCase()} result?`,
                function() { 
                    const dateKey = new Date(date).toDateString();
                    const resultsRef = getResultsRef();
                    const saveCountRef = getSaveCountRef();
                    if (!resultsRef || !saveCountRef) return;
                    
                    resultsRef.once('value').then((snapshot) => {
                        let results = snapshot.val() || {};
                        
                        if (results[dateKey] && results[dateKey][`${gameType}_${time}`]) {
                            delete results[dateKey][`${gameType}_${time}`];
                            
                            // If no data left for the date, delete the entire date
                            if (Object.keys(results[dateKey]).length === 0) {
                                delete results[dateKey];
                            }
                            
                            // Save updated data to Firebase
                            resultsRef.set(results).then(() => {
                                // Decrease save count
                                saveCountRef.once('value').then((countSnapshot) => {
                                    const saveCount = Math.max(0, (countSnapshot.val() || 0) - 1);
                                    saveCountRef.set(saveCount).then(() => {
                                        document.getElementById('saveCount').textContent = saveCount;
                                        
                                        // Update UI
                                        loadManageData();
                                        loadDateResults(document.getElementById('resultDate').value);
                                        
                                        alert(`${gameType.toUpperCase()} - ${getTimeName(time)} result deleted successfully!`);
                                    });
                                });
                            }).catch((error) => {
                                console.error("Error deleting result:", error);
                                alert('Error deleting result. Please try again.');
                            });
                        }
                    });
                }
            );
        };
        
        function resetAllData() {
            const resultsRef = getResultsRef();
            const saveCountRef = getSaveCountRef();
            if (!resultsRef || !saveCountRef) return;
            
            // Delete data from Firebase
            resultsRef.set({}).then(() => {
                saveCountRef.set(0).then(() => {
                    // Update UI
                    document.getElementById('saveCount').textContent = '0';
                    loadDateResults(document.getElementById('resultDate').value);
                    document.getElementById('manageResults').innerHTML = '';
                    
                    alert('All data has been reset!');
                });
            }).catch((error) => {
                console.error("Error resetting data:", error);
                alert('Error resetting data. Please try again.');
            });
        }
    </script>
</body>
</html>